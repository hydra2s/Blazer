<!doctype html>
<head>
    <title>WebGPU tester</title>
    <!--<script src="pako/pako_deflate.js"></script>-->
    <!--<script src="UPNG.js"></script>-->
    <script src="deps/crc32.js"></script>
    <script type="module" src="./blazer.js"></script>
</head>
<body>

    <svg style="position: absolute; left: 0px; top: 0px; pointer-events: none;" width="0" height="0">
        <filter id="alpha-fix" color-interpolation-filters="sRGB">
        <feColorMatrix type="matrix" values="
        0 0 0 0 1
        0 0 0 0 1
        0 0 0 0 1
        1 0 0 0 0"/>
        </filter></svg>

    <script type="module" async>
        import {loadImage, getSharedImageData, InterWork, provideForWorker, loadBitmapThroughput, IDBCache, OpenJNG} from "./blazer.js";

        const WC = new InterWork(provideForWorker(new Worker("./blazer.js", {type: "module"})), true);
        //const {OpenJNG} = await WC.proxy("default");
        
        
        const db = await new IDBCache().open("openjng", {
            upgrade(db) {
                const store = db.createObjectStore(location.hostname, {
                    keyPath: 'id',
                    autoIncrement: true,
                });
            }
        });
        //indexedDB.deleteDatabase("openjng");

        var jng = await new OpenJNG({
            loadBitmapThroughput: async (url)=>createImageBitmap(await loadImage(url))
        });
        document.body.appendChild(await loadImage(await jng.load("./img/opossum.jng")));
    </script>
</body>
</html>
