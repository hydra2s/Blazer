<!doctype html>
<head>
    <title>WebGPU tester</title>
    <!--<script src="pako/pako_deflate.js"></script>-->
    <!--<script src="UPNG.js"></script>-->
    <script src="node_modules/crc-32/crc32.js"></script>
    <script type="module" src="./blazer.js"></script>
</head>
<body>

    <script type="module" async>
        import {loadImageBitmap, loadImage, getSharedImageData, InterWork, provideForWorker, IDBCache, APNGDecoder, APNGPreRender} from "./blazer.js";

        const WC = new InterWork(provideForWorker(new Worker("./blazer.js", {type: "module"})), true);
        const {} = await WC.proxy("default");

        var apng = await new APNGDecoder();
        var frames = await apng.load("./img/butterfly.png");

        //let images = await Promise.all(frames.map((F)=>{
            //return loadImage(F.blob);
        //}));

        let prerender = new APNGPreRender(apng.width, apng.height, frames, {
            fullFrame: false, // applicable if your animator support x,y,width,height and clear draw (i.e. no blend op)
        });
        console.time("PreRender APNG");
        let bitmaps = await prerender.prerender();
        let canvasI = await Promise.all(bitmaps.map((I)=>loadImageBitmap(I)));
        console.timeEnd("PreRender APNG");

        canvasI.forEach(document.body.appendChild.bind(document.body));
        
    </script>
</body>
</html>
