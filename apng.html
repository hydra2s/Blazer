<!doctype html>
<head>
    <!-- meta -->
    <meta charset="utf-8" http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="HandheldFriendly" content="true" />

    <title>APNG testing</title>
    <!--<script src="pako/pako_deflate.js"></script>-->
    <!--<script src="UPNG.js"></script>-->
    <script async src="deps/crc32.js"></script>
    <script async type="module" src="./blazer.js"></script>

    <!-- Sanitize V2 -->
    <link rel="preload" href="sanitize-2/sanitize-2.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="sanitize-2/sanitize-2.css"></noscript>

    <!-- CSS library -->
    <link rel="preload" href="blazer.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="blazer.css"></noscript>

    <!-- Overlay scrollbars -->
    <link rel="preload" href="./overlayscrollbars/styles/overlayscrollbars.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="./overlayscrollbars/styles/overlayscrollbars.css"></noscript>
    <!--<script async type="module" src="./overlayscrollbars/overlayscrollbars.browser.es6.js"></script>-->

    <!-- Development version -->
    <script async src="https://unpkg.com/lucide@latest/dist/umd/lucide.js" crossorigin="anonymous"></script>

    <!--<script async type="module">
        import {  OverlayScrollbars } from './overlayscrollbars/overlayscrollbars.esm.js';
        OverlayScrollbars(document.querySelector('body'), { overflow: { x: 'hidden' } });
    </script>-->
</head>
<body><scroll-able>

    <script type="module" async>
        import {loadImageBitmap, loadImage, getSharedImageData, InterWork, provideForWorker, IDBCache} from "./blazer.js";

        const WC = new InterWork(provideForWorker(new Worker("./blazer.js", {type: "module"})), true);
        const { APNGPreRender, APNGDecoder } = await WC.proxy("default");

        var apng = await new APNGDecoder();

        console.time("Parsing and PreRender APNG");
        var frames = await apng.load("./img/butterfly.png");

        //let images = await Promise.all(frames.map((F)=>{
            //return loadImage(F.blob);
        //}));
        
        let prerender = await new APNGPreRender(apng.width, apng.height, frames, {
            fullFrame: false, // applicable if your animator support x,y,width,height and clear draw (i.e. no blend op)
        });
        
        
        let bitmaps = await prerender.prerender();
        
        let canvasI = await Promise.all(bitmaps.map((I)=>loadImageBitmap(I)));
        console.timeEnd("Parsing and PreRender APNG");

        canvasI.forEach(document.body.appendChild.bind(document.body));
        
    </script>

</scroll-able></body>
</html>
