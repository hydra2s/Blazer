<!doctype html>
<head>
    <!-- meta -->
    <meta charset="utf-8" http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="HandheldFriendly" content="true" />

    <title>BMP and WebWorker testing</title>

    <script async src="deps/crc32.js"></script>
    <script async type="module" src="./blazer.js"></script>

    <!-- CSS library -->
    <link rel="preload" href="blazer.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="blazer.css"></noscript>

    <!-- Overlay scrollbars -->
    <link rel="preload" href="./overlayscrollbars/styles/overlayscrollbars.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="./overlayscrollbars/styles/overlayscrollbars.css"></noscript>
    <!--<script async type="module" src="./overlayscrollbars/overlayscrollbars.browser.es6.js"></script>-->

    <meta http-equiv="origin-trial" content="AheTb7dTZtgoY8Fcsznx+0xlpDjy/teBncwVq9xG4xIf9qPWcZTOakvTzk/v7BtAeoL9xu7O87L57Lq7RhasZwgAAABeeyJvcmlnaW4iOiJodHRwOi8vbG9jYWxob3N0OjgwIiwiZmVhdHVyZSI6IlVucmVzdHJpY3RlZFNoYXJlZEFycmF5QnVmZmVyIiwiZXhwaXJ5IjoxNjg4MDgzMTk5fQ==">

    <!-- Development version -->
    <script async src="https://unpkg.com/lucide@latest/dist/umd/lucide.js" crossorigin="anonymous"></script>

    <script async type="module">
        import {  OverlayScrollbars } from './overlayscrollbars/overlayscrollbars.esm.js';
        OverlayScrollbars(document.querySelector('body'), { overflow: { x: 'hidden' } });
    </script>
</head>
<body>

    <script type="module" async>
        import {loadImage, InterWork, IDBCache} from "./blazer.js";

        //
        const WC = new InterWork(new Worker("./blazer.js", {type: "module"}), true);
        const {BlazerBMP, OffscreenCanvas, getSharedImageData} = await WC.proxy("default");

        //
        let canvas = await new OffscreenCanvas(512, 512);
        let ctx = await canvas.getContext("2d", { willReadFrequently: true });
        console.log(ctx);
        ctx.fillStyle = "rgba(255, 0, 0, 0.5)";
        ctx.fillRect(64, 64, 128, 128);

        //
        const blazer = await new BlazerBMP();
        await blazer.init().shared(getSharedImageData(ctx, 0,0, canvas.width, canvas.height));


        //console.time("FastBMP");
        //console.timeEnd("FastBMP");
        
        document.body.appendChild(await loadImage(blazer.encode()));
    </script>
</body>
</html>
