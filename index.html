<!doctype html>
<head>
    <title>WebGPU tester</title>
    <!--<script src="pako/pako_deflate.js"></script>-->
    <!--<script src="UPNG.js"></script>-->
    <script src="https://cdn.sheetjs.com/crc-32-latest/package/crc32.js"></script>
    <script src="https://cdn.sheetjs.com/crc-32-latest/package/crc32c.js"></script>
    <script type="module" src="./blazer.js"></script>
</head>
<body>

    <script type="module" async>
        import * as _module from "./blazer.js";
        import * as Comlink from "https://unpkg.com/comlink/dist/esm/comlink.mjs";
        
        //
        //const _module = await Comlink.wrap(new Worker("wbmp.js", {type: "module"}));
        
        //
        let canvas = await new OffscreenCanvas(512, 512);
        let ctx = await canvas.getContext("2d", { willReadFrequently: true });
        ctx.fillStyle = "rgba(255, 0, 0, 0.5)";
        ctx.fillRect(64, 64, 128, 128);

        //
        const blazer = await new _module.BlazerBMP();
        await blazer.init();
        await blazer.context(ctx, await canvas.width, await canvas.height);


        console.time("FastBMP");
        let blob = await blazer.encode();
        console.timeEnd("FastBMP");
        
        
        document.body.appendChild(await _module.loadImage(blob));
    </script>
</body>
</html>
