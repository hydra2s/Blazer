<!doctype html>
<head>
    <title>WebGPU tester</title>
    <!--<script src="pako/pako_deflate.js"></script>-->
    <!--<script src="UPNG.js"></script>-->
    <script src="https://cdn.sheetjs.com/crc-32-latest/package/crc32.js"></script>
    <script src="https://cdn.sheetjs.com/crc-32-latest/package/crc32c.js"></script>
    <script type="module" src="./blazer.js"></script>
</head>
<body>

    <script type="module">
        import {BlazerBMP, BlazerPNG} from "./blazer.js";

        (async()=>{

        //
        let loadImage = async (url) => {
            let image = new Image();
            image.decoding = "async";
            image.fetchPriority = "high";
            image.loading = "eager";
            image.src = await url;
            await image.decode();

            // FOR DEBUG!
            /*
            image.width = 160;
            image.height = 120;
            image.alt = "Problematic";
            document.body.appendChild(image);
            */

            //
            return image;
        }

        //
        let canvas = new OffscreenCanvas(512, 512);
        let ctx = canvas.getContext("2d", { willReadFrequently: true });
        ctx.fillStyle = "rgba(255, 0, 0, 0.5)";
        ctx.fillRect(64, 64, 128, 128);

        //
        let blazer = (await new BlazerBMP().init()).context(ctx, canvas.width, canvas.height);


        console.time("FastBMP");
        let blob = blazer.encode();
        console.timeEnd("FastBMP");
        
        
        document.body.appendChild(await loadImage(URL.createObjectURL(blob)));

    })();
    </script>
</body>
</html>
